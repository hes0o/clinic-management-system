<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:HealthCenter.Desktop.Features.Queue.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1920" d:DesignHeight="1080"
             x:Class="HealthCenter.Desktop.Features.Queue.Views.QueueDisplayView"
             x:DataType="vm:QueueDisplayViewModel"
             FlowDirection="RightToLeft">

    <UserControl.Styles>
        <Style Selector="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI, Arial"/>
        </Style>
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#2563EB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
        <Style Selector="Border.card">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="BoxShadow" Value="0 1 3 0 #1a000000"/>
        </Style>
    </UserControl.Styles>

    <Design.DataContext>
        <vm:QueueDisplayViewModel/>
    </Design.DataContext>

    <!-- Main Background: Light Gray like Dashboard -->
    <Grid Background="#F3F4F6">
       <!-- Content Area -->
       <Grid Margin="24">
           <Grid.RowDefinitions>
               <RowDefinition Height="100"/>
               <RowDefinition Height="*"/>
               <RowDefinition Height="Auto"/>
           </Grid.RowDefinitions>

           <!-- Row 0: Header -->
           <Border Grid.Row="0" Background="White" Padding="40,0" BoxShadow="0 1 3 0 #1a000000" CornerRadius="12" Margin="0,0,0,24">
               <Grid>
                   <Grid.ColumnDefinitions>
                       <ColumnDefinition Width="*"/>
                       <ColumnDefinition Width="Auto"/>
                   </Grid.ColumnDefinitions>

                   <!-- Clinic Info -->
                   <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="8">
                       <TextBlock Text="العيادة العامة - General Clinic" 
                                  FontSize="32" 
                                  FontWeight="Bold" 
                                  Foreground="#1E293B"/>
                       <StackPanel Orientation="Horizontal" Spacing="16">
                           <TextBlock Text="{Binding CurrentDateHijri}" 
                                      FontSize="18" 
                                      Foreground="#64748B"/>
                           <TextBlock Text="|" 
                                      Foreground="#E2E8F0"/>
                           <TextBlock Text="{Binding CurrentDateGregorian, StringFormat='{}{0:dd MMMM yyyy}'}" 
                                      FontSize="18" 
                                      Foreground="#64748B"/>
                       </StackPanel>
                   </StackPanel>

                   <!-- Time & Mute -->
                   <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="24" VerticalAlignment="Center">
                       <TextBlock Text="{Binding CurrentTime}" 
                                  FontSize="42" 
                                  FontWeight="SemiBold" 
                                  Foreground="#2563EB"
                                  VerticalAlignment="Center"/>
                       
                       <Button Command="{Binding ToggleMuteCommand}" 
                               Background="Transparent" 
                               Padding="8"
                               CornerRadius="8">
                           <TextBlock Text="{Binding MuteIcon}" 
                                      FontSize="24"/>
                       </Button>
                   </StackPanel>
               </Grid>
           </Border>

           <!-- Row 1: Main Display Area -->
           <Grid Grid.Row="1">
               <Grid.ColumnDefinitions>
                   <ColumnDefinition Width="1.5*"/>
                   <ColumnDefinition Width="*"/>
               </Grid.ColumnDefinitions>

               <!-- Col 0: Current Ticket (Right Side in RTL) -->
               <Border Grid.Column="0" Background="White" Margin="0,0,0,0" CornerRadius="12" BoxShadow="0 1 3 0 #1a000000">
                   <Grid>
                       <Grid.RowDefinitions>
                           <RowDefinition Height="*"/>
                           <RowDefinition Height="Auto"/>
                       </Grid.RowDefinitions>

                       <StackPanel Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20">
                           <TextBlock Text="الرقم الحالي" 
                                      FontSize="36" 
                                      Foreground="#64748B" 
                                      HorizontalAlignment="Center"/>
                           
                           <Border Background="#F0F9FF" 
                                   BorderBrush="#BFDBFE" 
                                   BorderThickness="2" 
                                   CornerRadius="24" 
                                   Padding="60,30">
                               <TextBlock Text="{Binding CurrentTicket.TicketNumber, FallbackValue='---'}" 
                                          FontSize="140" 
                                          FontWeight="Bold" 
                                          Foreground="#2563EB" 
                                          HorizontalAlignment="Center"/>
                           </Border>

                           <TextBlock Text="{Binding CurrentTicket.Patient.FullName}" 
                                      FontSize="32" 
                                      Foreground="#1E293B" 
                                      FontWeight="SemiBold"
                                      HorizontalAlignment="Center"/>
                       </StackPanel>

                       <!-- Status Message -->
                       <Border Grid.Row="1" Background="#FFF7ED" Padding="20" CornerRadius="0,0,12,12">
                           <TextBlock Text="يرجى التوجه إلى العيادة" 
                                      FontSize="24" 
                                      Foreground="#EA580C" 
                                      HorizontalAlignment="Center" 
                                      FontWeight="SemiBold"/>
                       </Border>
                   </Grid>
               </Border>

               <!-- Col 1: Waiting List & Health Tips (Left Side in RTL) -->
               <Grid Grid.Column="1" Margin="24,0,0,0">
                   <Grid.RowDefinitions>
                       <RowDefinition Height="*"/>
                       <RowDefinition Height="Auto"/>
                   </Grid.RowDefinitions>

                   <!-- Waiting List -->
                   <Border Grid.Row="0" Background="White" CornerRadius="12" BoxShadow="0 1 3 0 #1a000000" Padding="20">
                       <Grid>
                           <Grid.RowDefinitions>
                               <RowDefinition Height="Auto"/>
                               <RowDefinition Height="*"/>
                           </Grid.RowDefinitions>

                           <Border Grid.Row="0" BorderBrush="#E2E8F0" BorderThickness="0,0,0,1" Padding="0,0,0,16" Margin="0,0,0,16">
                               <Grid>
                                   <Grid.ColumnDefinitions>
                                       <ColumnDefinition Width="*"/>
                                       <ColumnDefinition Width="Auto"/>
                                   </Grid.ColumnDefinitions>
                                   <TextBlock Text="قائمة الانتظار" FontSize="20" FontWeight="Bold" Foreground="#1E293B"/>
                                   <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                       <TextBlock Text="{Binding PatientsAheadCount}" FontWeight="Bold" Foreground="#2563EB"/>
                                       <TextBlock Text="في الانتظار" Foreground="#64748B"/>
                                   </StackPanel>
                               </Grid>
                           </Border>

                           <ListBox Grid.Row="1" 
                                    ItemsSource="{Binding WaitingList}" 
                                    Background="Transparent" 
                                    BorderThickness="0">
                               <ListBox.ItemTemplate>
                                   <DataTemplate>
                                       <Border Padding="12" Margin="0,0,0,12" Background="#F8FAFC" CornerRadius="8">
                                           <Grid>
                                               <Grid.ColumnDefinitions>
                                                   <ColumnDefinition Width="Auto"/>
                                                   <ColumnDefinition Width="*"/>
                                                   <ColumnDefinition Width="Auto"/>
                                               </Grid.ColumnDefinitions>

                                               <Border Grid.Column="0" 
                                                       Background="#EFF6FF" 
                                                       CornerRadius="6" 
                                                       Width="40" Height="40" 
                                                       VerticalAlignment="Center">
                                                   <TextBlock Text="{Binding TicketNumber}" 
                                                              HorizontalAlignment="Center" 
                                                              VerticalAlignment="Center" 
                                                              FontWeight="Bold" 
                                                              Foreground="#2563EB"/>
                                               </Border>

                                               <TextBlock Grid.Column="1" 
                                                          Text="{Binding Patient.FullName}" 
                                                          VerticalAlignment="Center" 
                                                          Margin="12,0" 
                                                          FontWeight="Medium" 
                                                          Foreground="#334155"/>

                                               <TextBlock Grid.Column="2" 
                                                          Text="انتظار" 
                                                          VerticalAlignment="Center" 
                                                          FontSize="12" 
                                                          Foreground="#64748B"/>
                                           </Grid>
                                       </Border>
                                   </DataTemplate>
                               </ListBox.ItemTemplate>
                           </ListBox>
                       </Grid>
                   </Border>

                   <!-- Estimated Time -->
                   <Border Grid.Row="1" Background="#1E293B" Margin="0,24,0,0" CornerRadius="12" Padding="20">
                       <Grid>
                           <Grid.ColumnDefinitions>
                               <ColumnDefinition Width="*"/>
                               <ColumnDefinition Width="Auto"/>
                           </Grid.ColumnDefinitions>
                           
                           <StackPanel Grid.Column="0" VerticalAlignment="Center">
                               <TextBlock Text="الوقت المتوقع" Foreground="#94A3B8" FontSize="14"/>
                               <TextBlock Text="{Binding EstimatedWaitTimeMinutes, StringFormat='{}{0} دقيقة'}" 
                                          Foreground="White" 
                                          FontSize="28" 
                                          FontWeight="Bold"/>
                           </StackPanel>

                           <Border Grid.Column="1" Background="#334155" Width="50" Height="50" CornerRadius="25">
                               <TextBlock Text="" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                           </Border>
                       </Grid>
                   </Border>
       
               </Grid>
           </Grid>

           <!-- Row 2: Footer: Health Tips -->
           <Border Grid.Row="2" Margin="40,24,40,24" Background="#DCFCE7" BorderBrush="#86EFAC" BorderThickness="1" CornerRadius="12" Padding="20">
               <Grid>
                   <Grid.ColumnDefinitions>
                       <ColumnDefinition Width="*"/>
                       <ColumnDefinition Width="Auto"/>
                   </Grid.ColumnDefinitions>

                   <TextBlock Grid.Column="0" 
                              Text="{Binding CurrentHealthTip}" 
                              FontSize="20" 
                              Foreground="#166534" 
                              FontWeight="SemiBold"
                              HorizontalAlignment="Center" 
                              VerticalAlignment="Center"/>

                   <Border Grid.Column="1" Background="#16A34A" Padding="8,4" CornerRadius="6">
                       <TextBlock Text="معلومة صحية" Foreground="White" FontSize="12"/>
                   </Border>
               </Grid>
           </Border>
       </Grid>
    </Grid>
</UserControl>

